<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.safetyplatform.dao.HiddenRiskCheckCorrectDao">
    <!--目的:为dao接口方法提供sql语句配置
    即针对dao接口中的方法编写我们的sql语句-->


    <!--<update id="reduceNumber">-->
    <!--UPDATE seckill-->
    <!--SET numbers = numbers-1-->
    <!--WHERE seckill_id=#{seckillId}-->
    <!--AND start_time <![CDATA[ <= ]]> #{killTime}-->
    <!--AND end_time >= #{killTime}-->
    <!--AND numbers > 0;-->
    <!--</update>-->

    <select id="getTotalNumHRCCL" resultType="int">
    select count(*) from enter_hidden_relation  right join zyjk on zyjk.risk_id = enter_hidden_relation.risk_id and enter_hidden_relation.enter_id = #{enterId}
        and status = #{status}
        <if test="businessType != 'other'">
            where  zyjk.main_object like CONCAT('%',#{businessType})
        </if>

    </select>

    <select id="getHiddenRiskCheckCorrectList" resultMap="HRCCTemp">
        select zyjk.*,ehr.enter_id,ehr.status,ehr.uid,ehr.check_img,ehr.check_man,ehr.check_time,ehr.correct_man,ehr.correct_time from enter_hidden_relation ehr  right join zyjk on zyjk.risk_id = ehr.risk_id and ehr.enter_id = #{enterId}
and status = #{status}
        <if test="businessType != 'other'">
           where zyjk.main_object like CONCAT('%',#{businessType})
        </if>
        limit #{start},#{limit};

    </select>

    <update id="updateHiddenRiskCheck">
        UPDATE enter_hidden_relation
        SET check_img = #{filePath}
        WHERE UID = #{reportId}
    </update>

    <insert id="insertHiddenRiskCheck">
        <!--当出现主键冲突时(即重复秒杀时)，会报错;不想让程序报错，加入ignore-->
        INSERT ignore INTO enter_hidden_relation(enter_id,risk_id,check_img)
        VALUES (#{enterId},#{riskId},#{filePath})
    </insert>

    <insert id="insertHiddenRiskCheckNoFile">
        INSERT ignore INTO enter_hidden_relation(enter_id,risk_id,check_man,status,check_time)
        VALUES (#{enterId},#{riskId},#{checkMan},#{status},#{checkTime});
    </insert>

    <update id="updateHiddenRiskCorrectNoFile">
        update enter_hidden_relation
        <trim prefix="set" suffixOverrides=",">

            <if test="correctMan != null">correct_man=#{correctMan},</if>
            <if test="correctTime != null">correct_time=#{correctTime},</if>
            <if test="status != null">status=#{status},</if>

        </trim>
        where uid=#{uid}
    </update>



    <resultMap id="HRCCTemp" type="HiddenRiskCheckCorrect">

        <result column="status" property="status" jdbcType="TINYINT" javaType="Boolean" />

    </resultMap>


    <!--<select id="getEnterMainTypeNum" resultType="com.safetyplatform.entity.risk_index.RiskEvaluateResult">-->
        <!--SELECT danger_level_num,count(*) as result-->
        <!--FROM enter_hidden_relation ehr ,zyjk-->
        <!--where ehr.risk_id = zyjk.risk_id and ehr.enter_id = #{enterId} and ehr.status = 1-->
        <!--group by danger_level_num order by danger_level_num asc;-->
    <!--</select>-->


</mapper>